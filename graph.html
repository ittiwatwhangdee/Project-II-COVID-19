<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Coronavirus Update (Live)</title>
    <link rel="icon" href="img/check.png">
    <link href="https://unpkg.com/bootstrap@4.4.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://use.fontawesome.com/releases/v5.12.1/css/all.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.css" rel="stylesheet">
    <!-- Retina iPad Touch Icon-->
    <link rel="apple-touch-icon" sizes="144x144" href="http://placehold.it/144.png/000/fff">
    <!-- Retina iPhone Touch Icon-->
    <link rel="apple-touch-icon" sizes="114x114" href="http://placehold.it/114.png/000/fff">
    <!-- Standard iPad Touch Icon-->
    <link rel="apple-touch-icon" sizes="72x72" href="http://placehold.it/72.png/000/fff">
    <!-- Standard iPhone Touch Icon-->
    <link rel="apple-touch-icon" sizes="57x57" href="http://placehold.it/57.png/000/fff">

    <!-- Styles -->
    <link href="assets/css/lib/weather-icons.css" rel="stylesheet" />
    <link href="assets/css/lib/owl.carousel.min.css" rel="stylesheet" />
    <link href="assets/css/lib/owl.theme.default.min.css" rel="stylesheet" />
    <link href="assets/css/lib/font-awesome.min.css" rel="stylesheet">
    <link href="assets/css/lib/themify-icons.css" rel="stylesheet">
    <link href="assets/css/lib/menubar/sidebar.css" rel="stylesheet">
    <link href="assets/css/lib/bootstrap.min.css" rel="stylesheet">

    <link href="assets/css/lib/helper.css" rel="stylesheet">
    <link href="assets/css/style.css" rel="stylesheet">

</head>
<body>
    <div class="sidebar sidebar-hide-to-small sidebar-shrink sidebar-gestures">
        <div class="nano">
            <div class="nano-content">
                <div class="logo"><a href="index.html">
                        <!-- <img src="assets/images/logo.png" alt="" /> --><span>COVID-19</span></a></div>
                <ul>
                    <li><a href="index.html"><i class="ti-home"></i> Home </a></li>
                    <li><a href="about.html"><i class="ti-user"></i> About </a></li>
                    <li><a class="sidebar-sub-toggle"><i class="ti-bar-chart-alt"></i> Check <span
                                class="sidebar-collapse-icon ti-angle-down"></span></a>
                        <ul>
                            <li><a href="country.html">Table</a></li>
                            <li><a href="map.html">Map</a></li>
                            <li><a href="graph.html">Graph</a></li>
                        </ul>
                    </li>
                    <li><a href="survey.html"><i class="ti-calendar"></i> Survey </a></li>

                </ul>

            </div>
        </div>
    </div>
    <!--sidebar-->
    <div class="header">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12">
                    <div class="float-left">
                        <div class="hamburger sidebar-toggle">
                            <span class="line"></span>
                            <span class="line"></span>
                            <span class="line"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="content-wrap">
        <div class="main">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-8 p-r-0 title-margin-left">
                        <div class="page-header">
                            <div class="page-title">
                                <h1>Coronavirus Graph Update <span>(Live)</span></h1>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 p-l-0 title-margin-left ">
                        <div class="page-header">
                            <div class="page-title">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="index.html">Dashboard</a></li>
                                    <li class="breadcrumb-item active">Live</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container-fluid mt-2">
                    <div id="toolbar">
                        <h3>COVID-19 Graph Update <span>(Live)</span></h3>
                    </div>
                    <table id="table" data-toolbar="#toolbar" data-search="true" data-show-toggle="true"
                        data-show-columns="true" data-show-columns-toggle-all="true" data-show-export="true"
                        data-sort-name="totalcases" data-sort-order="desc" data-show-pagination-switch="true"
                        data-pagination="false" data-page-list="[10, 25, 50, 100, all]" data-show-footer="true">
                    </table>
                </div>

    <div class="container-fluid my-3">
        <div class="row">
            <div class="col-4 mr-auto form-group">
                <select id="country" class="form-control"></select>
            </div>
        </div>
        <div class="card card-body">
            <canvas id="myChart" style="width:100%; height:500px;"></canvas>
        </div>
    </div>
    <!-- jquery vendor -->
    <script src="assets/js/lib/jquery.min.js"></script>
    <script src="assets/js/lib/jquery.nanoscroller.min.js"></script>
    <!-- nano scroller -->
    <script src="assets/js/lib/menubar/sidebar.js"></script>
    <script src="assets/js/lib/preloader/pace.min.js"></script>
    <!-- sidebar -->
    <script src="assets/js/lib/bootstrap.min.js"></script>
    <!-- scripit init-->
    <script src="assets/js/lib/vector-map/jquery.vmap.min.js"></script>
    <!-- scripit init-->
    <script src="assets/js/lib/vector-map/jquery.vmap.sampledata.js"></script>
    <script src="https://unpkg.com/jquery@3.4.1/dist/jquery.min.js"></script>
    <script src="https://unpkg.com/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/bootstrap@4.4.1/dist/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.24.0/min/moment.min.js"></script> <!-- moment-with-locales.min.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script> <!-- Chart.bundle.min.js -->
    <script>
        var covidstatus = [
            {title: 'Deaths', slug: 'deaths', backgroundColor: '#FA0303', borderColor: '#BD0606'}, 
            {title: 'Recovered', slug: 'recovered', backgroundColor: '#34F906', borderColor: '#08CB19'},
            {title: 'Coronavirus Cases', slug: 'confirmed', backgroundColor: '#ffb0c1', borderColor: '#ff6384'}
        ];
        
        $('#country').html('<option disabled selected>-- Select country or region --</option>');
        axios.get('https://api.covid19api.com/countries').then(function(res) {
            res.data.forEach(function(row) {
                $('#country').append('<option value="'+row.Slug+'">'+row.Country+'</option>');
            });
        });
        
        var store = localStorage;
        var getStore = store.getItem('myCountry') ? store.getItem('myCountry') : 'italy';
        
        var mychart = myChart();
        countryData(getStore, covidstatus, mychart);
        
        $('#country').on('change', function() {
            store.setItem('myCountry', $(this).val());
            window.location.reload();
        });
        
        function countryData(country, status, chart) {
            getLabelData(chart);
            status.forEach(function(item, index) {
                getCountryData(item.slug, country, chart, index);
            });
        }
        
        function getLabelData(chart) {
            axios.get('https://api.covid19api.com/total/country/italy/status/confirmed').then(function(response) {
                chart.data.labels = formatData(response.data, 'label');
                chart.update();
            })
        }
        
        function getCountryData(status, country, chart, index) {
            axios.get('https://api.covid19api.com/total/country/'+country+'/status/'+status).then(function(response) {
                chart.data.datasets[index].data = formatData(response.data, 'data');
                chart.update();
            }).catch(function(error) {
                console.log(error);
            });
        }
        
        function formatData(data, type) {
            var list = [];
            data.forEach(function(item) {
                if(type == 'data') {
                    list.push(item.Cases);
                } else if(type == 'label') {
                    list.push(new Date(item.Date).getDate());
                }
            });
            return list.slice(data.length - 7, data.length);
        }
        
        function myChart() {
            var myBasicChart = new Chart('myChart', {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: dataSets(covidstatus)
                },
                options: {
			        responsive: true,
			        title: {
				        display: true,
				        text: 'COVID-19 Live Update'
			        },
				    tooltips: {
					    mode: 'index',
					    intersect: true,
				    },
                    scales: {
                        xAxes: [{
					        display: true,
				        }],
				        yAxes: [{
					        display: true,
				        }]
                    }
                }
            });
            return myBasicChart;
        }
        
        function dataSets(data) {
            var sets = [];
            data.forEach(function(item) {
                sets.push({
                    label: item.title,
                    data: [],
                    backgroundColor: item.backgroundColor,
                    borderColor: item.borderColor,
                    borderWidth: 3,
                    fill: true
                });
            });
            return sets;
        }
    </script>
</body>
</html>
